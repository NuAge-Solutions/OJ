OJ.importJs("oj.events.OjActionable");OJ.importJs("oj.events.OjEvent");OJ.importJs("oj.net.OjUrl");OJ.importJs("oj.timer.OjTimer");"use strict";OJ.extendManager("HistoryManager","OjHistoryManager",[OjActionable],{_previous:null,_next:null,_current:0,_native:false,_timer:0,_ignore_next:false,_list:null,PREVIOUS:"previous",NEXT:"next",FORWARD:"historyForward",BACK:"historyBack",CHANGE:"historyChange",_constructor:function(){this._super(OjActionable,"_constructor",arguments);this._list=[new OjUrl(window.location.href)];try{var a=window.history.previous;this._native=true;a=null}catch(b){}if("onhashchange" in window){window.onhashchange=function(c){HistoryManager._onChange(c)}}else{this._timer=new OjTimer(1000,0);this._timer.addEventListener(OjTimer.TICK,HistoryManager,"_onChange");this._timer.start()}},_destructor:function(){OJ.destroy(this._timer);return this._super(OjActionable,"_destructor",arguments)},_onChange:function(){var b=HistoryManager.get();if(b.toString()!=window.location.href){var a=new OjUrl(window.location.href);if(OJ.getDepth()<0){if(a.toString()==this.get(-1).toString()){this._current--}else{if(a.toString()==this.get(this._current+1).toString()){this._current++}else{this._current=0;this._list.unshift(a)}}}else{if(this._current==0){this._list=[this._list[0]]}else{this._list=this._list.slice(0,this._current+1)}this._list.push(a);this._current=this._list.length-1}this._previous=this.get(-1);this._next=this.get(this._current+1);this._dispatchChange(b,a)}},_dispatchChange:function(b,a){this.dispatchEvent(new OjEvent(HistoryManager.CHANGE,true))},get:function(){var b,a=arguments.length?arguments[0]:this._current;if(this._native){if(window.history[a]){return new OjUrl(window.history[a])}b=this._list[a]}else{if(a<0){b=this._list[Math.max(this._current+a,0)]}else{if(a>=this._list.length){b=this._list[this._list.length-1]}else{b=this._list[a]}}}return b?b.clone():null},previous:function(){return this._previous},next:function(){return this._next},go:function(c){if(this._native){window.history.go(c);return}var a;if(isNaN(index)){var b=this._list.length;while(b-->0){if(this._list[b].toString()==c){a=c;break}}this._current=b}else{a=this.get(c);this._current=c}OJ.open(a)},forward:function(){if(this._native){window.history.forward();return}OJ.open(this.get(this._current+1))},back:function(){if(this._native){window.history.back();return}OJ.go(this.get(this._current-1))},length:function(){return this._list.length}});