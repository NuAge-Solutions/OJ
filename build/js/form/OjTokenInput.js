OJ.importJs("oj.form.OjFilterBox");OJ.importJs("oj.form.OjToken");OJ.importJs("oj.list.OjList");OJ.importCss("oj.form.OjTokenInput");"use strict";OJ.extendClass("OjTokenInput",[OjInput],{_allow_none:false,_allow_duplicate:false,_options:null,_available:null,_selected:null,filterBox:null,_constructor:function(){var a=arguments.length;this._selected=[];this._value=[];this._super(OjInput,"_constructor",a>2?[].slice.call(arguments,0,2):arguments);if(a>2){if(a>3){this.setOptions(arguments[3])}this.setValue(arguments[2])}this.valueHldr.addEventListener(OjListEvent.ITEM_REMOVE,this,"_onListItemRemove");this.filterBox.addEventListener(OjEvent.CHANGE,this,"_onFilterChange")},_setDom:function(a){this._super(OjInput,"_setDom",arguments);var b=this.input.parent();this.filterBox=new OjFilterBox();this.filterBox.setAllowNone(true);this.filterBox.setValue(null);this.filterBox.addCss("filter","grey");b.addChildAt(this.filterBox,b.indexOfChild(this.input)+1);this.valueHldr=new OjList();this.valueHldr.setItemRenderer(OjToken);this.valueHldr.addCss("value");this.inputWrpr.addChild(this.valueHldr)},_addValue:function(a){return this._addValueAt(a,this._value.length,arguments.length>2?arguments[2]:false)},_addValueAt:function(b,a){this._value.splice(a,0,b);if(!this._options){return}this._selected.splice(a,0,this._options[b]);this.valueHldr.addItemAt(this._options[b],a);if(!this._allow_duplicate){delete this._available[b];this.filterBox.setOptions(this._available);if(!Object.keys(this._available).length){this.filterBox.hide()}}if(arguments.length<3||!arguments[2]){this.dispatchEvent(new OjEvent(OjEvent.CHANGE,true,true))}return b},_removeValue:function(b){var a=this._value.length;while(a-->0){if(this._value[a]==b){return this._removeValueAt(a,arguments.length>2?arguments[2]:false)}}return null},_removeValueAt:function(a){var b=this._value[a];if(!this._options){this._values.splice(a,1);return b}this.valueHldr.removeItemAt(a);if(arguments.length<3||!arguments[2]){this.dispatchEvent(new OjEvent(OjEvent.CHANGE,true,true))}return b},_moveValueTo:function(b,a){this.dispatchEvent(new OjEvent(OjEvent.CHANGE,true,true))},_onFilterChange:function(a){if(a.getTarget()==this.filterBox&&this.filterBox.getValue()!=null){this._addValue(this.filterBox.getValue());this.filterBox.setValue(null)}},_onListItemRemove:function(a){var b=this._value.splice(a.getIndex(),1);this._selected.splice(a.getIndex(),1);if(!this._allow_duplicate){this._available[b]=this._options[b];this.filterBox.setOptions(this._available);this.filterBox.show()}},getAllowNone:function(){return this._allow_none},setAllowNone:function(a){this._allow_none=a},getAllowDuplicate:function(){return this._allow_duplicate},setAllowDuplicate:function(a){this._allow_duplicate=a},getOptions:function(){return this._options},setOptions:function(a){this._options=a;this._available=OJ.merge({},a);this.filterBox.setOptions(this._available);this.setValue(this._value.clone())},getSelected:function(){return this._selected},setSelected:function(a){this._selected=a},getTokenRenderer:function(){return this.valueHldr.getItemRenderer()},setTokenRenderer:function(a){this.valueHldr.setItemRenderer(a)},_onChange:function(){},setValue:function(c){var d=[],b=this._value.length;while(b-->0){this._removeValueAt(b,true)}if(c){b=c.length;for(var a=0;a<b;a++){this._addValueAt(c[a],a,true)}}this.dispatchEvent(new OjEvent(OjEvent.CHANGE,true,true))}});