OJ.importJs("oj.nav.OjNavController");OJ.importJs("oj.components.OjLabel");OJ.importJs("oj.dom.OjStyleElement");OJ.importJs("oj.events.OjEvent");OJ.importJs("oj.events.OjStackEvent");OJ.importJs("oj.fx.OjFade");OJ.importJs("oj.fx.OjMove");OJ.importJs("oj.fx.OjTweenSet");OJ.importCss("oj.nav.OjFlowNavController");"use strict";window.OjIFlowNavController={_props_:{cancelLabel:"Cancel",title:null},_back_btn:null,_cancel_btn:null,_show_cancel:false,_template:"oj.nav.OjFlowNavController",_tween:null,bottom:null,btmLeft:null,btmRight:null,btmTitle:null,title:null,top:null,topLeft:null,topRight:null,topTitle:null,_makeBackButton:function(a){var b=new OjButton(a.getShortTitle());b.addCss(["back-button"]);return b},_makeCancelButton:function(b){var a=new OjButton(b);a.addCss(["cancel-button"]);return a},_makeTitle:function(a){var b=new OjLabel(a);b.setVAlign(OjStyleElement.MIDDLE);return b},_update:function(k,p,i,o){this._unset("_tween");var l=this.top,g=this.topLeft,c=this.topTitle,d=this.topRight,w=this.bottom,f=this.btmLeft,s=this.btmTitle,y=this.btmRight,h=g.numChildren()?this.topLeft.getChildAt(0):null,x=c.numChildren()?c.getChildAt(0):null,u=d.numChildren()?d.getChildAt(0):null,j=k.getActionView(),z=k.getCancelView(),r=k.getTitleView(),A;if(!r&&(A=k.getTitle())){r=this._makeTitle(A)}if(this._back_btn){this._back_btn.removeEventListener(OjMouseEvent.CLICK,this,"_onBackClick")}else{if(this._cancel_btn){this._cancel_btn.removeEventListener(OjMouseEvent.CLICK,this,"_onCancelClick")}}if(!z){if(i>0){z=this._makeBackButton(this._stack.getElmAt(i-1))}else{if(this._show_cancel){z=this._cancel_btn=this._makeCancelButton(this._cancelLabel)}}}if(i>0){this._back_btn=z;z.addEventListener(OjMouseEvent.CLICK,this,"_onBackClick")}else{if(this._show_cancel){this._cancel_btn=z;z.addEventListener(OjMouseEvent.CLICK,this,"_onCancelClick")}}if(h!=z){if(h){f.addChild(h)}if(z){g.addChild(z)}}if(u!=j){if(u){y.addChild(u)}if(j){d.addChild(j)}}if(x!=r){if(x){s.addChild(x)}if(r){c.addChild(r)}}l.setX(0);l.setAlpha(1);w.setX(0);w.setAlpha(1);var q=p&&p.getEffect()?p.getEffect():OjTransition.DEFAULT;if(q==OjTransition.NONE){this.removeCss(["animating"]);l.show();w.hide();f.removeAllChildren();s.removeAllChildren();y.removeAllChildren();return}this.addCss("animating");this._tween=new OjTweenSet();var v=0,a=p.getDuration(),n=p.getEasing(),m=this.getWidth();if(o!=-1){if(o>i){v=m*-0.5}else{if(o<i){v=m*0.5}}}if(v&&q!=OjTransition.FADE){w.setX(0);l.setX(v);l.setAlpha(0);this._tween.addTween(new OjMove(w,OjMove.X,-1*v*0.5,a*0.5),n[1]);this._tween.addTween(new OjMove(l,OjMove.X,0,a,n[1]))}else{l.setAlpha(0)}this._tween.addTween(new OjFade(w,OjFade.OUT,a,n[1]));this._tween.addTween(new OjFade(l,OjFade.IN,a,n[0]));this._tween.addEventListener(OjTweenEvent.COMPLETE,this,"_onTweenComplete");this._tween.start()},_onBackClick:function(a){this.back()},_onCancelClick:function(a){this.dispatchEvent(new OjEvent(OjEvent.CANCEL,false))},_onBackComplete:function(a){this._stack.removeItemAt(this._stack.numItems()-1);this._stack.removeEventListener(OjStackEvent.CHANGE_COMPLETE,this,"_onBackComplete")},_onStackChange:function(a){this._update(a.getView(),a.getTransition(),a.getIndex(),a.getOldIndex())},_onTweenComplete:function(a){this._unset("_tween");this.btmLeft.removeAllChildren();this.btmTitle.removeAllChildren();this.btmRight.removeAllChildren();this.removeCss(["animating"])},showCancel:function(){if(arguments.length){this._show_cancel=arguments[0]}return this._show_cancel},back:function(){this._stack.removeElm(this._stack.getActive());this.dispatchEvent(new OjEvent(OjFlowNavController.BACK))},setTitle:function(a){if(this._title==a){return}if(!this.title){this.title=this._makeTitle();this.topTitle.addChild(this.title)}this.title.setText(this._title=a)},setCancelLabel:function(a){if(this._cancelLabel==a){return}this._cancelLabel=a;if(this._cancel_btn){this._cancel_btn.setLabel(a)}}};OJ.extendComponent("OjFlowNavController",[OjNavController],OJ.implementInterface(OjIFlowNavController,{_constructor:function(){this._super(OjNavController,"_constructor",[]);if(arguments.length){this.setStack(arguments[0])}},_setupStack:function(){this._super(OjNavController,"_setupStack",arguments);this._stack.setTransition(new OjTransition(OjTransition.SLIDE_HORZ,250,[OjEasing.IN,OjEasing.OUT]));this._stack.addEventListener(OjStackEvent.ADD,this,"_onStackAdd")},_cleanupStack:function(){this._super(OjNavController,"_cleanupStack",arguments);if(this._stack){this._stack.removeEventListener(OjStackEvent.ADD,this,"_onStackAdd")}},_onStackAdd:function(a){this._stack.setActive(a.getView())}}),{_TAGS:["flownav"],BACK:"onFlowNavBack"});