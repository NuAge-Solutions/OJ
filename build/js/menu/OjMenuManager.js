OJ.importJs("oj.data.OjRect");OJ.importJs("oj.events.OjTransformEvent");OJ.importJs("oj.events.OjMouseEvent");OJ.importJs("oj.fx.OjFade");OJ.importJs("oj.menu.OjMenu");OJ.importJs("oj.window.OjWindowManager");"use strict";OJ.extendManager("MenuManager","OjMenuManager",[OjActionable],{_menus:null,_active:null,_tweens:null,_constructor:function(){this._super(OjActionable,"_constructor",arguments);this._menus={};this._active={};this._tweens={}},_percentRectVisible:function(c){var b=OJ.getViewport();var a={top:c.top>0&&c.top>=b.top?c.top:b.top,left:c.left>0&&c.left>=b.left?c.left:b.left,bottom:b.bottom>=c.bottom?c.bottom:b.bottom,right:b.right>=c.right?c.right:b.right};return((c.bottom-c.top)*(c.right-c.left))/((a.bottom-a.top)*(a.right-a.left))},_positionMenu:function(b,e){var g=b.getPositioning();var h,j;var d,a=0;var c,f=g.length;for(c=0;c<f;c++){h=this[g[c]](e,b);j=this._percentRectVisible(h);if(j==1){break}else{if(j>a){a=j;d=h}}h=null}if(!h){h=d}b.setX(h.left);b.setY(h.top)},_removeMenus:function(b){var a,c=new OjTweenSet();for(a in b){OJ.destroy(this._tweens[a]);OjElement.byId(a).removeEventListener(OjTransformEvent.MOVE,this,"_onTargetMove");c.addTween(new OjFade(b[a],OjFade.OUT));delete this._active[a];delete this._tweens[a]}if(c.numTweens()){c.addEventListener(OjTweenEvent.COMPLETE,this,"_onTransOut");c.start()}},_onPageClick:function(a){var b,d,c;for(b in this._active){d=this._active[b];if(d&&d.hitTestPoint(a.getPageX(),a.getPageY())){return}c=OjElement.byId(b);if(c&&c.hitTestPoint(a.getPageX(),a.getPageY())){return}}this._removeMenus(this._active);OJ.removeEventListener(OjMouseEvent.CLICK,this,"_onPageClick")},_onTargetClick:function(a){var b=a.getCurrentTarget();var c=this._menus[b.id()];if(c&&!this._active[b.id()]){this.show(c,b)}},_onTargetMove:function(a){var b=a.getCurrentTarget();var c=this._menus[b.id()];if(c){this._positionMenu(c,b)}},_onTransOut:function(a){OJ.destroy(a.getCurrentTarget())},hide:function(d){var b,e,c=0;for(b in this._active){c++;if(this._active[b]==d){e=b}}if(e){var a={};a[e]=d;delete this._active[e];this._removeMenus(a);if(c==1){OJ.removeEventListener(OjMouseEvent.CLICK,this,"_onPageClick")}}},register:function(c,b){c.addEventListener(OjMouseEvent.CLICK,this,"_onTargetClick");var d=new OjMenu(b);var a=arguments.length;if(a>2){d.setPositioning(arguments[2]);if(a>3){d.setParentMenu(arguments[3])}}this._menus[c.id()]=d;return d},show:function(e){var d=arguments.length>1?arguments[1]:null;var b,c={};if(!d){for(b in this._menus){if(this._menus[b]==e){d=OjElement.byId(b);break}}}for(b in this._active){if(this._active[b]!=e&&!this._active[b].hasSubMenu(e)){c[b]=this._active[b]}}this._removeMenus(c);e.setAlpha(0);OJ.addChild(e);if(e){this._positionMenu(e,d);var a=new OjFade(e);a.start();this._active[d.id()]=e;this._tweens[d.id()]=a;OJ.addEventListener(OjMouseEvent.CLICK,this,"_onPageClick")}d.addEventListener(OjTransformEvent.MOVE,this,"_onTargetMove")},unregister:function(b){if(b.is("OjMenu")){var a;for(a in this._menus){if(this._menus[a]==b){b=OjElement.byId(a);break}}}if(b){b.removeEventListener(OjMouseEvent.CLICK,this,"_onTargetClick");delete this._menus[b.id()]}},positionTopLeft:function(a,b){return new OjRect(a.getPageX()-b.getHorzOffset(),a.getPageY()-b.getHeight()-b.getVertOffset(),b.getWidth(),b.getHeight())},positionTopCenter:function(a,b){return new OjRect(a.getPageX()+((a.getWidth()-b.getWidth())/2),a.getPageY()-b.getHeight(),b.getWidth(),b.getHeight())},positionTopRight:function(a,b){return new OjRect(a.getPageX()+a.getWidth()-b.getWidth(),a.getPageY()-b.getHeight(),b.getWidth(),b.getHeight())},positionBottomLeft:function(a,b){return new OjRect(a.getPageX(),a.getPageY()+a.getHeight(),b.getWidth(),b.getHeight())},positionBottomCenter:function(a,b){return new OjRect(a.getPageX()+((a.getWidth()-b.getWidth())/2),a.getPageY()+a.getHeight(),b.getWidth(),b.getHeight())},positionBottomRight:function(a,b){return new OjRect(a.getPageX()+a.getWidth()-b.getWidth(),a.getPageY()+a.getHeight(),b.getWidth(),b.getHeight())},positionLeftTop:function(a,b){return new OjRect(a.getPageX()-b.getWidth(),a.getPageY(),b.getWidth(),b.getHeight())},positionLeftMiddle:function(a,b){return new OjRect(a.getPageX()-b.getWidth(),a.getPageY()+((a.getHeight()-b.getHeight())/2),b.getWidth(),b.getHeight())},positionLeftBottom:function(a,b){return new OjRect(a.getPageX()-b.getWidth(),a.getPageY()+a.getHeight()-b.getHeight(),b.getWidth(),b.getHeight())},positionRightTop:function(a,b){return new OjRect(a.getPageX()+a.getWidth(),a.getPageY(),b.getWidth(),b.getHeight())},positionRightMiddle:function(a,b){return new OjRect(a.getPageX()+a.getWidth(),a.getPageY()+((a.getHeight()-b.getHeight())/2),b.getWidth(),b.getHeight())},positionRightBottom:function(a,b){return new OjRect(a.getPageX()+a.getWidth(),a.getPageY()+a.getHeight()-b.getHeight(),b.getWidth(),b.getHeight())}});